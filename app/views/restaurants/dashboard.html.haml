%h1 Listing restaurants


%table.table.table-striped
  %tr
    %th #Name
    %th #Voter
    %th #Votes positifs
    %th #Votes négatifs
    %th #Total votes


  - @restaurants.each do |restaurant|
    -if restaurant.votes.count > 0 && restaurant.votes.last.updated_at == Date.today
      %tr
        %td= restaurant.name
        %td
          .btn-group
            -if current_user.voted_for_today? restaurant
              %button.btn.btn-inverse.disabled Vote effectué
              %button.btn.btn-inverse.disabled.dropdown-toggle(data-toggle="dropdown")
            -else
              %button.btn.btn-primary Vote
              %button.btn.btn-primary.dropdown-toggle(data-toggle="dropdown")
                %span.caret
              %ul.dropdown-menu
                %li
                  = link_to upvote_restaurant_path(restaurant) do
                    %i.icon-plus
                    Positif
                %li
                  = link_to downvote_restaurant_path(restaurant) do
                    %i.icon-minus
                    Négatif
        %td
          -user = restaurant.votes.map { |vote| vote.voter.first_name if (vote.updated_at == Date.today && vote.vote_flag == true) }.compact.join(', ')
          %span.badge.badge-success{:rel => "popover", "data-content" => "#{user}", "data-original-title" => "Votants"}=restaurant.votes.count(:all, :conditions => {:updated_at => Time.now.midnight..(Time.now.midnight + 1.day), :vote_flag => true})
        %td
          -user = restaurant.votes.map { |vote| vote.voter.first_name if (vote.updated_at == Date.today && vote.vote_flag == false) }.compact.join(', ')
          %span.badge.badge-important{:rel => "popover", "data-content" => "#{user}", "data-original-title" => "Votants"}=restaurant.votes.count(:all, :conditions => {:updated_at => Time.now.midnight..(Time.now.midnight + 1.day), :vote_flag => false})
        %td
          -user = restaurant.votes.map { |vote| vote.voter.first_name if vote.updated_at == Date.today }.compact.join(', ')
          %span.badge.badge-info{:rel => "popover", "data-content" => "#{user}", "data-original-title" => "Votants"}=restaurant.votes.count(:all, :conditions => {:updated_at => Time.now.midnight..(Time.now.midnight + 1.day)})
%br
%br
%br

= link_to 'New Restaurant', new_restaurant_path, :class => "btn btn-primary", :style => "color:white!important;"
-if current_user.has_role? :admin
  = link_to 'Restaurants', restaurants_path, :class => "btn btn-primary", :style => "color:white!important;"

